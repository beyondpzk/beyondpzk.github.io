<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> FlowMatching | Tenacious life, proud journey. </title> <meta name="author" content="P W Name"> <meta name="description" content="A simple, whitespace theme for academics. Based on [*folio](https://github.com/bogoli/-folio) design. "> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; img-src 'self' data: https:; font-src 'self' data: https:; media-src 'self' https:; frame-src 'self' https:; connect-src 'self' https:;"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?v=a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?v=f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?v=62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?v=591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?v=d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://beyondpzk.github.io/blog/2022/FlowMatching/"> <script src="/assets/js/theme.js?v=5fea5159b787642c1bbc1f334d60f883"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?v=5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> Tenacious life, proud journey. </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">CV </a> </li> <li class="nav-item "> <a class="nav-link" href="/teaching/">teaching </a> </li> <li class="nav-item "> <a class="nav-link" href="/people/">people </a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">submenus </a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item " href="/books/">bookshelf</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/blog/">blog</a> </div> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="fa-solid fa-magnifying-glass"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-half-sun-moon" id="light-toggle-system"></i> <i class="fa-solid fa-moon" id="light-toggle-dark"></i> <i class="fa-solid fa-sun" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">FlowMatching</h1> <p class="post-meta"> Created on October 06, 2022 </p> <p class="post-tags"> <a href="/blog/2022"> <i class="fa-solid fa-calendar fa-sm"></i> 2022 </a>   ·   <a href="/blog/tag/aigc"> <i class="fa-solid fa-hashtag fa-sm"></i> AIGC</a>   ·   <a href="/blog/category/aigc"> <i class="fa-solid fa-tag fa-sm"></i> AIGC</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <p>[TOC]</p> <h1 id="flowmatching">FlowMatching</h1> <ul> <li><a href="https://arxiv.org/abs/2210.02747" rel="external nofollow noopener" target="_blank">paper地址</a></li> </ul> <h1 id="flow-matching-for-generative-modeling">Flow Matching for Generative Modeling</h1> <p><strong>论文</strong>：<em>Flow Matching for Generative Modeling</em> (ICLR 2023)</p> <hr> <h2 id="第一部分生成模型的演进与-cnf-的困境-introduction--context">第一部分：生成模型的演进与 CNF 的困境 (Introduction &amp; Context)</h2> <h3 id="11-全景图">1.1 全景图</h3> <p>这篇论文之前，我们需要先理清两条并行的技术路线：</p> <ol> <li> <strong>Diffusion Models (扩散模型)</strong>：大家都很熟悉，Stable Diffusion, DALL-E 2 背后的技术。它们基于随机微分方程 (SDE)，通过去噪来生成数据。优点是训练极其稳定（这就是为什么它们火了），但缺点是采样极其低效，路径弯曲复杂。</li> <li> <strong>Continuous Normalizing Flows (CNFs, 连续归一化流)</strong>：这是我们今天的重点。CNF 基于常微分方程 (ODE)。</li> </ol> <p><strong>核心问题</strong>：在 Flow Matching 出现之前，CNF 虽然数学形式优美（确定性、可逆），但几乎无法在大规模数据上训练。为什么？</p> <h3 id="12-cnf-的数学定义回顾">1.2 CNF 的数学定义回顾</h3> <p>让我们回顾一下 CNF。CNF 也是将简单的噪声分布 $p_0$ (如高斯) 变换为复杂的数据分布 $p_1$ (如 ImageNet)。 这个变换是通过一个随时间变化的向量场 $v_t(x)$ 定义的 ODE 来实现的： \(\frac{d\phi_t(x)}{dt} = v_t(\phi_t(x))\) 其中 $\phi_t(x)$ 是流映射 (Flow map)。</p> <p><strong>难点在于似然计算</strong>。根据 <em>Instantaneous Change of Variables Theorem</em>，对数密度的变化率是： \(\frac{\partial \log p_t(x)}{\partial t} = -\text{Tr}\left( \frac{\partial v_t}{\partial x} \right) = -\text{div}(v_t(x))\) 要训练这个模型，最大化似然需要计算雅可比矩阵的迹（Trace of Jacobian）。对于高维图像，这个计算复杂度是 $O(d^2)$ 甚至 $O(d^3)$。虽然有 Hutchinson Trace Estimator 可以近似，但在训练中需要求解整个 ODE 积分，这不仅慢，而且数值不稳定。</p> <h3 id="13-本文的突破口">1.3 本文的突破口</h3> <p>这篇文章的作者 Lipman 等人提出：<strong>我们要放弃极大似然训练 (Maximum Likelihood Training)</strong>。 不要去解那个昂贵的 ODE 积分来计算似然。相反，我们要用一种 <strong>“无需模拟 (Simulation-Free)”</strong> 的回归方法。我们直接告诉模型：“在这个时刻 $t$，你应该往哪个方向流”，这就是 <strong>Flow Matching</strong>。</p> <hr> <h2 id="第二部分flow-matching-核心理论-the-theory-of-flow-matching">第二部分：Flow Matching 核心理论 (The Theory of Flow Matching)</h2> <h3 id="21-目标回归向量场">2.1 目标：回归向量场</h3> <p>假设存在一个理想的概率路径 $p_t(x)$，它从噪声 $p_0$ 平滑过渡到数据 $p_1$。既然有概率路径，这就意味着必然存在一个<strong>生成这一路径的向量场</strong> $u_t(x)$。 这由连续性方程 (Continuity Equation) 保证。 (这里需要补充一些东西.)</p> <p>我们要训练神经网络 $v_t(x; \theta)$ 去逼近这个理想向量场 $u_t(x)$。 目标函数非常直观： \(\mathcal{L}_{FM}(\theta) = \mathbb{E}_{t \sim U[0,1], x \sim p_t(x)} \| v_t(x) - u_t(x) \|^2\)</p> <alphaxiv-paper-citation title="FM Objective" page="3" first="The Flow Matching" last="u_t(x)‖^2"></alphaxiv-paper-citation> <p>这看起来很简单，但有一个巨大的陷阱：<strong>我们根本不知道 $u_t(x)$ 是什么！</strong> 我们只有数据 $x_1$ (来自目标数据分布 $q(x)$) 和噪声 $x_0$ (来自高斯 $p(x)$)。我们不知道中间的 $p_t$ 长什么样，更不知道生成它的宏观向量场 $u_t$ 是什么。对于复杂的数据集（如 ImageNet），这个 $u_t$ 是 intractable（不可计算）的。</p> <h3 id="22-破局conditional-flow-matching-cfm">2.2 破局：Conditional Flow Matching (CFM)</h3> <p>这是整篇论文最天才的一步。 既然宏观的 $p_t$ 搞不定，我们把问题分解到<strong>微观</strong>层面。</p> <table> <tbody> <tr> <td>我们定义<strong>条件概率路径</strong> $p_t(x</td> <td>x_1)$。这表示：给定<strong>某一张</strong>特定的目标图片 $x_1$，噪声 $x_0$ 是如何变成这张 $x_1$ 的？这个微观路径可以设计得非常简单（比如高斯分布）。</td> </tr> <tr> <td>如果路径简单，那么生成这个微观路径的<strong>条件向量场</strong> $u_t(x</td> <td>x_1)$ 也就很简单，是可以直接写出公式的。</td> </tr> </tbody> </table> <p><strong>关键定理 (Theorem 2)</strong>： 我们不需要回归宏观向量场 $u_t(x)$，我们只需要回归微观向量场 $u_t(x|x_1)$。 作者证明了： \(\nabla*\theta \mathcal{L}*{FM}(\theta) = \nabla*\theta \mathcal{L}*{CFM}(\theta)\) 其中 CFM 的损失函数为： \(\mathcal{L}_{CFM}(\theta) = \mathbb{E}_{t, q(x_1), p_t(x|x_1)} \| v_t(x) - u_t(x|x_1) \|^2\)</p> <alphaxiv-paper-citation title="CFM Theorem" page="4" first="has the same" last="L_CFM(θ)."></alphaxiv-paper-citation> <p>为什么这两个不一样的 Loss 会有相同的梯度？既然梯度一样,那优化这两个就是等价的. 展开平方项： \(\| v - u \|^2 = \|v\|^2 - 2\langle v, u \rangle + \|u\|^2\) \(\| v - u(\cdot|x*1) \|^2 = \|v\|^2 - 2\langle v, u(\cdot|x_1) \rangle + \|u(\cdot|x_1)\|^2\) 这里 $|v|^2$ 项是一样的。常数项对梯度无影响。关键在于交叉项 $\langle v, u \rangle$。 数学上可以证明，宏观向量场 $u_t(x)$ 其实就是微观向量场 $u_t(x|x_1)$ 的加权平均（边缘化）： \(u_t(x) = \mathbb{E}*{x_1 \sim p(x_1|x)} [u_t(x|x_1)]\) (我觉得上面这个公式是MeanFlows的出发点.) 所以，只要神经网络 $v_t$ 学会了拟合每一个样本的微观方向，在统计期望上，它自然就学会了正确的宏观方向。(我的理解: 训练时虽然有多种多样的路径对, 但是训完模型后,模型就知道哪些路是最容易的,这也对应Rectified flow中的那个图,为什么训完后会调头,不会交叉;)</p> <blockquote> <p><strong>比喻</strong>： (我觉得这个比喻不好) 想象你要预测下班高峰期的人流（宏观向量场）。 方法一（FM）：你试图直接测量整个城市每个路口的人流速度矢量。这太难了。 方法二（CFM）：你随机抽取一百万个人，问每个人：“你家在哪？公司在哪？你打算怎么走？”如果你能预测每一个个体的简单直线运动，把这些预测聚合起来，你其实就完美预测了整个城市的宏观人流。</p> </blockquote> <hr> <h2 id="第三部分如何设计路径-instantiations-of-probability-paths">第三部分：如何设计路径？ (Instantiations of Probability Paths)</h2> <table> <tbody> <tr> <td>现在我们有了 CFM 框架，剩下的问题就是：我们选什么样的微观路径 $p_t(x</td> <td>x_1)$？</td> </tr> </tbody> </table> <h3 id="31-扩散路径-diffusion-paths--连接过去">3.1 扩散路径 (Diffusion Paths) —— 连接过去</h3> <p>论文首先展示了 Flow Matching 可以完全兼容并包含扩散模型。 对于扩散模型，条件分布通常是： \(p_t(x|x_1) = \mathcal{N}(x | \alpha_t x_1, \beta_t^2 I)\) 这是一个随时间收缩方差的高斯分布。 它对应的条件向量场是： (Why?) \(u_t(x|x_1) = \frac{\sigma'\_t(x_1) (x - \mu_t(x_1))}{\sigma_t(x_1)} + \mu'\_t(x_1)\) 结论是：如果我们用 FM 框架去训练扩散路径，得到的模型效果比传统的 Score Matching 还要好，训练更稳定。但这并没有解决根本问题——<strong>路径依然是弯曲的</strong>。</p> <h3 id="32-最优传输路径-optimal-transport-paths--通向未来">3.2 最优传输路径 (Optimal Transport Paths) —— 通向未来</h3> <p>这是本文最想推销的方案。既然我们可以自定义路径，为什么不定义一个最简单的？ 两点之间，直线最短。</p> <p><strong>OT 条件路径定义</strong>： 我们定义均值 $\mu_t$ 随时间线性变化，从 $0$ 变到 $x_1$。 \(p*t(x|x_1) = \mathcal{N}(x | t x_1, (1 - (1 - \sigma*{min})t)^2 I)\) 这里 $\sigma_{min}$ 是一个小量，防止 $t=1$ 时方差坍缩为 0 导致数值问题。</p> <alphaxiv-paper-citation title="OT Path" page="5" first="Example II: Optimal" last="σ_min)t."></alphaxiv-paper-citation> <p><strong>OT 条件向量场推导 (Detailed derivation)</strong>： 对于这种线性插值路径 $\psi_t(x_0) = (1-t)x_0 + t x_1$（假设 $\sigma_{min} \approx 0$ 简化理解）。 这个粒子的速度是什么？对时间求导： \(\frac{d}{dt}\psi*t(x_0) = x_1 - x_0\) 速度是恒定的！ 但是向量场 $u_t(x)$ 需要是位置 $x$ 的函数，而不是初始点 $x_0$ 的函数。 我们要把 $x_0$ 换掉。因为 $x = (1-t)x_0 + t x_1$，所以 $x_0 = \frac{x - t x_1}{1-t}$。 代入速度公式，经过整理得到论文中的公式 21： \(u_t(x|x_1) = \frac{x_1 - (1-\sigma*{min})x}{1 - (1-\sigma\_{min})t}\)</p> <alphaxiv-paper-citation title="OT Vector Field" page="5" first="u_t(x|x_1) =" last="σ_min)t"></alphaxiv-paper-citation> <p><strong>这一步的物理意义</strong>： 这个向量场引导样本<strong>走直线</strong>。这意味着：</p> <ol> <li> <strong>Transport Cost 最小</strong>：这是 Optimal Transport 的本质。</li> <li> <strong>ODE Solver 极度友好</strong>：如果你在解一个 $\frac{dx}{dt} = \text{常数}$ 的方程，哪怕用最简单的 Euler 方法，一步就能算准。虽然后期变成了复杂的神经网络，但这种“由于设计而产生的直线倾向”被保留了下来。</li> </ol> <hr> <h2 id="第四部分实验与结果分析-experiments--analysis">第四部分：实验与结果分析 (Experiments &amp; Analysis)</h2> <h3 id="41-训练效率">4.1 训练效率</h3> <p>看 Figure 2 和 Figure 3。</p> <ul> <li> <strong>Diffusion Vector Field</strong>：你看那个场，是随时间剧烈变化的，中间还要绕弯。</li> <li> <strong>OT Vector Field</strong>：方向几乎不变，只是模长在变。 这导致神经网络更容易学习 OT 场。论文提到 FM 的收敛速度显著快于 Diffusion。 <alphaxiv-paper-citation title="Consistent Direction" page="6" first="OT VF has" last="constant direction"></alphaxiv-paper-citation> </li> </ul> <h3 id="42-imagenet-上的-sota">4.2 ImageNet 上的 SOTA</h3> <p>在 ImageNet 64x64 和 128x128 上，Flow Matching (FM-OT) 在 NLL (Negative Log Likelihood) 和 FID (Fréchet Inception Distance) 上都击败了当时的顶尖扩散模型（如 ADM）。 这一点很重要，因为这是第一次证明 CNF 这种基于 ODE 的方法，在生成质量上可以和基于 SDE 的扩散模型硬碰硬。 <alphaxiv-paper-citation title="Performance" page="1" first="consistently better performance" last="diffusion-based methods"></alphaxiv-paper-citation></p> <h3 id="43-采样速度-nfe-analysis">4.3 采样速度 (NFE Analysis)</h3> <p>这是工业界最看重的。看 <strong>Figure 7</strong>。</p> <ul> <li>横轴是 NFE (Number of Function Evaluations)，即调用神经网络的次数。</li> <li>纵轴是 FID (越低越好)。</li> <li>看那条红线 (FM-OT)：在 NFE=10 到 20 的时候，FID 已经非常低了。</li> <li>对比蓝线 (Diffusion)：在低 NFE 时效果很差，必须要在 NFE &gt; 100 时才能追上 FM。 这就是<strong>直线路径</strong>带来的巨大红利。我们可以用 <code class="language-plaintext highlighter-rouge">dopri5</code> 这种自适应步长求解器，它会自动发现路径很直，然后迈大步子，极大地节省计算量。 <alphaxiv-paper-citation title="Sampling Speed" page="9" first="FM with OT" last="diffusion baselines."></alphaxiv-paper-citation> </li> </ul> <hr> <h2 id="第五部分总结与展望-conclusion">第五部分：总结与展望 (Conclusion)</h2> <h3 id="51-takeaways">5.1 Takeaways</h3> <ol> <li> <strong>Simulation-Free Training</strong>：FM 让我们不再需要解 ODE 就能训练 ODE 模型。</li> <li> <strong>Unified View</strong>：FM 把 Diffusion 降级为一种特殊的、非最优的路径选择。</li> <li> <strong>Optimal Transport</strong>：直线路径是生成模型的未来（这一点已经被后续的 Stable Diffusion 3, Flux 等模型证实，它们都转向了 Rectified Flow / Flow Matching 架构）。</li> </ol> <h3 id="52-潜在的局限性">5.2 潜在的局限性</h3> <ul> <li> <strong>训练时的随机性</strong>：虽然路径是直的，但我们需要对 $t$ 进行采样。如果 $t$ 接近 1，且 $\sigma_{min}$ 很小，向量场的数值可能会很大（除以接近0的数），这在工程实现上需要注意（通常设置 $\sigma_{min}=1e-5$）。</li> <li> <strong>模型容量</strong>：虽然任务简单了，但要在大分辨率上拟合高频细节，依然需要巨大的神经网络参数量。</li> </ul> <h1 id="为什么公式21意味着让粒子走直线">为什么公式(21)意味着让粒子走直线</h1> <p>理解公式 (21) 为什么代表直线运动，我们可以从<strong>物理直观</strong>和<strong>数学推导</strong>两个层面来理解。</p> <p>为了方便，令 $\sigma_{min} = 0$（即假设噪声完全消除），这样公式会变得非常干净，物理意义一目了然。</p> <hr> <h3 id="1-物理直观剩余距离--剩余时间">1. 物理直观：剩余距离 / 剩余时间</h3> <p>当 $\sigma_{min} = 0$ 时，公式 (21) 简化为： \(u_t(x|x_1) = \frac{x_1 - x}{1 - t}\)</p> <p>这时候，我们可以这样解读公式中的每一项：</p> <ul> <li> <strong>分子 $(x_1 - x)$</strong>：这是一个向量，指向<strong>目标</strong> $x_1$ 减去 <strong>当前位置</strong> $x$。 <ul> <li>这决定了<strong>方向</strong>：永远指向终点 $x_1$。既然方向永远指向终点，且终点固定，那么轨迹必然是一条直线。</li> </ul> </li> <li> <strong>分母 $(1 - t)$</strong>：这是<strong>剩余时间</strong>（总时间是1，当前时间是 $t$）。</li> <li> <strong>整体含义</strong>： \(\text{速度} = \frac{\text{剩余距离}}{\text{剩余时间}}\)</li> </ul> <p><strong>想象</strong>：</p> <blockquote> <p>“想象你要在 1 小时内从学校走到市中心（直线距离）。 过了 0.5 小时，你还剩一半路程。你的速度应该是多少？ 速度 = 剩余路程 / 剩余时间。 只要你时刻保持这个速度公式，你就是在做<strong>匀速直线运动</strong>。”</p> </blockquote> <p>这就是公式 (21) 最本质的物理含义：它描述了一个<strong>匀速直线</strong>奔向目标的运动过程。</p> <hr> <h3 id="2-数学推导从结果反推原因">2. 数学推导：从结果反推原因</h3> <p>在论文中，作者的逻辑是反过来的：<strong>不是因为有了这个向量场才走出了直线，而是因为我们定义了直线路径，才推导出了这个向量场。</strong></p> <p><strong>Step 1: 定义直线路径 (Flow Map)</strong> 我们强制规定粒子 $x$ 从 $x_0$（噪声）到 $x_1$（数据）走的是线性插值（Linear Interpolation）： \(\psi*t(x_0) = (1 - t)x_0 + t x_1\) *(注：这里为了简化展示，暂时忽略 $\sigma*{min}$，其逻辑完全一致)*</p> <p><strong>Step 2: 计算速度 (Velocity)</strong> 对时间 $t$ 求导，得到速度： \(v_t = \frac{d}{dt}\psi_t(x_0) = x_1 - x_0\) 注意，这里的速度 $x_1 - x_0$ 是一个常数向量！这意味着粒子在做<strong>匀速</strong>运动。</p> <p><strong>Step 3: 坐标变换 (Coordinate Change)</strong> 这步最关键。Vector Field $u_t(x)$ 必须是<strong>当前位置</strong> $x$ 的函数，不能包含初始位置 $x_0$（因为在推理阶段我们不知道 $x_0$）。我们需要把 $x_0$ 消掉。</p> <p>由 Step 1 的公式： \(x = (1 - t)x_0 + t x_1\) 反解出 $x_0$： \((1-t)x_0 = x - t x_1 \implies x_0 = \frac{x - t x_1}{1 - t}\)</p> <p><strong>Step 4: 代入速度公式</strong> 将 $x_0$ 代回 Step 2 的速度公式： \(v_t = x_1 - \left( \frac{x - t x_1}{1 - t} \right)\) 通分整理： \(v_t = \frac{x_1(1-t) - (x - t x_1)}{1 - t}\) \(v_t = \frac{x_1 - t x_1 - x + t x_1}{1 - t}\) \(v_t = \frac{x_1 - x}{1 - t}\)</p> <p><strong>结论</strong>： 这就是公式 (21) 的由来。 所以，公式 (21) 仅仅是“匀速直线运动”这个物理过程在欧拉视角（Eulerian viewpoint，即向量场视角）下的数学表达。</p> <alphaxiv-paper-citation title="OT Vector Field" page="5" first="u_t(x|x_1) =" last="σ_min)t"></alphaxiv-paper-citation> <h3 id="3-稍微复杂一点的情况-sigma_min--0">3. 稍微复杂一点的情况 ($\sigma_{min} &gt; 0$)</h3> <p>如果加上 $\sigma_{min}$（论文原版公式），逻辑是一样的，只是“直线”没变，“匀速”变成了“变速直线”。</p> <p>原公式： \(x*t = (1 - (1 - \sigma*{min})t)x_0 + t x_1\) 这里 $x_0$ 的系数不再是 $(1-t)$，但这依然是一个关于 $t$ 的<strong>一次函数</strong>。 \(x_t = A \cdot t + B\) 只要位置 $x$ 是时间 $t$ 的一次函数，轨迹在空间中就一定是一条直线。</p> <h3 id="总结">总结</h3> <ol> <li> <strong>几何上</strong>：分子 $x_1 - (1-\sigma_{min})x$ 主要是 $x_1 - x$ 的变体，保证了向量场方向始终指向目标与当前位置的连线方向。</li> <li> <strong>动力学上</strong>：这个公式就是通过强行定义 $x(t)$ 为线性函数，$u_t = \dot{x}(t)$ 反推出来的结果。它保证了 Optimal Transport 的核心属性——路径最短（直线）且运输成本最低。</li> </ol> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="https://blog.google/technology/ai/google-gemini-update-flash-ai-assistant-io-2024/" target="_blank" rel="external nofollow noopener">Google Gemini updates: Flash 1.5, Gemma 2 and Project Astra</a> <svg width="1rem" height="1rem" viewbox="0 0 30 30" xmlns="http://www.w3.org/2000/svg"> <path d="M17 13.5v6H5v-12h6m3-3h6v6m0-6-9 9" class="icon_svg-stroke" stroke="#999" stroke-width="1.5" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path> </svg> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="https://medium.com/@al-folio/displaying-external-posts-on-your-al-folio-blog-b60a1d241a0a?source=rss-17feae71c3c4------2" target="_blank" rel="external nofollow noopener">Displaying External Posts on Your al-folio Blog</a> <svg width="1rem" height="1rem" viewbox="0 0 30 30" xmlns="http://www.w3.org/2000/svg"> <path d="M17 13.5v6H5v-12h6m3-3h6v6m0-6-9 9" class="icon_svg-stroke" stroke="#999" stroke-width="1.5" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path> </svg> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2026/DriveJEPA/">DriveJEPA</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2026/C_RADIOv4/">C_RADIOv4</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2026/VLM4VLA/">VLM4VLA</a> </li> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2026 P W Name. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?v=a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?v=85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?v=2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?v=c15de51d4bb57887caa2c21988d97279"></script> <script defer src="/assets/js/copy_code.js?v=c8a01c11a92744d44b093fc3bda915df" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?v=d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?v=a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?v=2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?v=f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/assets/js/search/ninja-keys.min.js?v=a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?v=6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?v=ccc841c459bfc0e64c1c2b5acd10df02"></script> </body> </html>